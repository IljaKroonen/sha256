<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SHA256</title>

    <link rel="stylesheet" href="styles.css">
    <script src="sha256-min.js"></script>
</head>

<body>
    <h1>SHA256</h1>
    <div class="app-container">
        <label for="input" class="button">Browse</label><span class="upload-label">Please select a file</span>
        <input id="input" type="file"></input>
        <div class="current">
            <div class="name"></div>
            <div class="hash"></div>
            <div class="progress">
                <div></div>
            </div>
            <div class="time"></div>
            <div class="speed"></div>
        </div>
        <h2>History</h2>
        <div class="results">
        </div>
    </div>

    <template>
        <div class="result-card">
            <div class="filename"></div>
            <div class="hash"></div>
            <div class="time"></div>
            <div class="speed"></div>
        </div>
    </template>

    <script>
        const state = {};

        function add(name, size) {
            state.name = name;
            state.size = size;
            state.started = new Date().getTime();
            document.querySelector('.current .hash').innerText = '';
            document.querySelector('.current .hash').classList.add('loading');
            document.querySelector('.current .name').innerText = name;
            document.querySelector('input').setAttribute('disabled', 'disabled');
            document.querySelector('label').classList.add('disabled');
            update(0);
        }
        
        function update(progressPercent) {
            const elapsed = new Date().getTime() - state.started;
            const speed = progressPercent * state.size / 100 / elapsed * 1000 / 1024 / 1024;
            document.querySelector('.current .speed').innerText = speed.toFixed(2) + ' MB/s';
            document.querySelector('.current .time').innerText = (elapsed / 1000).toFixed(2) + ' seconds elapsed';
            document.querySelector('.current .progress>div').style.width = progressPercent + '%';
        }
        
        function done(hash) {
            const elapsed = new Date().getTime() - state.started;
            const speed = state.size / elapsed * 1000 / 1024 / 1024;
            document.querySelector('.current .hash').innerText = hash;
            document.querySelector('.current .hash').classList.remove('loading');
            
            const template = document.querySelector('template').content.cloneNode(true);
            template.querySelector('.filename').innerText = state.name;
            template.querySelector('.hash').innerText = hash;
            template.querySelector('.time').innerText = elapsed / 1024 + ' seconds';
            template.querySelector('.speed').innerText = speed + 'MB/s';
            document.querySelector('.results').appendChild(template);
            document.querySelector('input').setAttribute('disabled', null);
            document.querySelector('label').classList.remove('disabled');
        }
        
        const input = document.querySelector('input');
        input.addEventListener('change', () => {
            if (!input.value)
                return;
                
            add(input.files[0].name, input.files[0].size);
                
            const before = new Date();
            sha256(input.files[0], done, update);
        });
    </script>
</body>

</html>